title: "README"
author: "Sandi Jones"
date: "7/13/2019"
output:
  pdf_document: default
  html_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Storm Events 
### Hurricane

The tidyverse library contains the required packages for this project. The data used can be found at [NOAA Storm Events Index](ftp://ftp.ncdc.noaa.gov/pub/data/swdi/stormevents/csvfiles/). The most recent 15 years of complete data (2004 - 2018) is used in this analysis. First each file is read into a data frame, then each data frame is vertically merged into one using the rbind() function.  

```{r echo=TRUE, eval=FALSE, message=FALSE, warning=FALSE, paged.print=FALSE}
 library("tidyverse")
 Storm2004 <- read.csv("2004StormEvents.csv", header=TRUE, stringsAsFactors = FALSE)
 Storm2005 <- read.csv("2005StormEvents.csv", header=TRUE, stringsAsFactors = FALSE)
 Storm2006 <- read.csv("2006StormEvents.csv", header=TRUE, stringsAsFactors = FALSE)
 Storm2007 <- read.csv("2007StormEvents.csv", header=TRUE, stringsAsFactors = FALSE)
 Storm2008 <- read.csv("2008StormEvents.csv", header=TRUE, stringsAsFactors = FALSE)
 Storm2009 <- read.csv("2009StormEvents.csv", header=TRUE, stringsAsFactors = FALSE)
 Storm2010 <- read.csv("2010StormEvents.csv", header=TRUE, stringsAsFactors = FALSE)
 Storm2011 <- read.csv("2011StormEvents.csv", header=TRUE, stringsAsFactors = FALSE)
 Storm2012 <- read.csv("2012StormEvents.csv", header=TRUE, stringsAsFactors = FALSE)
 Storm2013 <- read.csv("2013StormEvents.csv", header=TRUE, stringsAsFactors = FALSE)
 Storm2014 <- read.csv("2014StormEvents.csv", header=TRUE, stringsAsFactors = FALSE)
 Storm2015 <- read.csv("2015StormEvents.csv", header=TRUE, stringsAsFactors = FALSE)
 Storm2016 <- read.csv("2016StormEvents.csv", header=TRUE, stringsAsFactors = FALSE)
 Storm2017 <- read.csv("2017StormEvents.csv", header=TRUE, stringsAsFactors = FALSE)
 Storm2018 <- read.csv("2018StormEvents.csv", header=TRUE, stringsAsFactors = FALSE)

 Storm <- do.call("rbind", list(Storm2004, Storm2005,Storm2006, Storm2007, Storm2008, Storm2009, Storm2010,
              Storm2011, Storm2012, Storm2013, Storm2014, Storm2015, Storm2016, Storm2017,
              Storm2018))
 StormTemp <- Storm

```

The DAMAGE_PROPERTY variable represents property damage amount. It is of particular interest to this project, but must be manipulated into a usable format.  
For Example, 100k should be 100,000. A loop is used to interate through each row of the column DAMAGE_PROPERTY.   
For each row:  

- The last character, which specifies units is removed. Then the remaining string is converted to numeric.  
- The numeric value is adjusted according to the last character of the string.
  - For example, if the last character is a K, then the value is mulitplied by 1,000. The same is done for the characters M and B, representing factors of 1,000,000 and 1,000,000,000 respectively.   
- To adjust for inflation, the numeric value is adjusted according to the CPI factor of the associated year.
- A new date variable was created using an R date format.

```{r echo=TRUE, eval=FALSE, message=FALSE, warning=FALSE, paged.print=FALSE}
for (i in 1:nrow(StormTemp)){
damage <- toString(StormTemp[i, "DAMAGE_PROPERTY"])
year <- (StormTemp[i, "YEAR"])
date <- (StormTemp[i, "BEGIN_DATE_TIME"])
#Remove units from DAMAGE_PROPERTY
if (nchar(damage)==6 & str_sub(damage,6,6) %in% c("K", "M", "B")){
  case <- str_sub(damage,6,6)
  damage <- as.numeric(str_sub(damage, 1, 5))
}else if (nchar(damage==5) & str_sub(damage,5,5)%in%c("K", "M", "B")){
  case <- str_sub(damage,5,5)
  damage <- as.numeric(str_sub(damage, 1, 4))
}else if (nchar(damage)==4 & str_sub(damage,4,4)%in%c("K", "M", "B")){
  case <- str_sub(damage,4,4)
  damage <- as.numeric(str_sub(damage, 1, 3))
}else if (nchar(damage)==3 & str_sub(damage,3,3)%in%c("K", "M", "B")){
  case <- str_sub(damage,3,3)
  damage <- as.numeric(str_sub(damage, 1, 2))
}else if (nchar(damage)==2 & str_sub(damage,2,2)%in%c("K", "M", "B")){
  case <- str_sub(damage,2,2)
  damage <- as.numeric(str_sub(damage, 1, 1))
}else{
  case <- "X"
  damage <- as.numeric(damage)
}
#Adjust for inflation using CPI
if(year=="2004"){
  CPI_Factor <- 1.32
}else if(year=="2005"){
  CPI_Factor <- 1.28
}else if(year=="2006"){
  CPI_Factor <- 1.24
}else if(year=="2007"){
  CPI_Factor <- 1.2
}else if(year=="2008"){
  CPI_Factor <- 1.2
}else if(year=="2009"){
  CPI_Factor <- 1.16
}else if(year=="2010"){
  CPI_Factor <- 1.15
}else if(year=="2011"){
  CPI_Factor <- 1.11
}else if(year=="2012"){
  CPI_Factor <- 1.09
}else if(year=="2013"){
  CPI_Factor <- 1.08
}else if(year=="2014"){
  CPI_Factor <- 1.07
}else if(year=="2015"){
  CPI_Factor <- 1.06
}else if(year=="2016"){
  CPI_Factor <- 1.04
}else if(year=="2017"){
  CPI_Factor <- 1.02
}else{
  CPI_Factor <- 1
}
if(case=="K"){
  damage <- damage*1000*CPI_Factor
}else if(case=="M"){
  damage <- damage*1000000*CPI_Factor
}else if(case=="B"){
  damage <- damage*1000000000*CPI_Factor
}else{
  damage <- damage*CPI_Factor
}
StormTemp[i, "DAMAGE_PROPERTY"] <- damage
StormTemp[i, "DATE"] <- as.Date(str_sub(date, 1, 10), format="%m/%d/%Y")
}
StormFinal <- StormTemp
```
The observations of hurricanes in the EVENT_TYPE column included both labels "Hurricane (Typhoon)" and "Hurricane". For uniformity, another loop was used to replace "Hurricane (Typhoon)" with "Hurricane". 

```{r echo=TRUE, eval=FALSE, message=FALSE, warning=FALSE, paged.print=FALSE}
# Combine Hurricane and Hurricane (Typhoon)
for (j in 1:nrow(StormFinal)){  
event <- toString(StormFinal[j, "EVENT_TYPE"])

if (event %in% c("Hurricane (Typhoon)", "Hurricane"))  {
  event="Hurricane"
}
StormFinal[j, "EVENT_TYPE"] <- event
}
```

```{R message=FALSE, warning=FALSE, include=FALSE}
setwd("~/R/win-library/3.6")
load("StormFinalData")
```

Summary Statistics for property damage amount:
```{R}
mean(as.numeric(!is.na(StormFinal$DAMAGE_PROPERTY)))  #Mean of overall property damage
sd(as.numeric(!is.na(StormFinal$DAMAGE_PROPERTY)))  #Standard Deviation of overall property damage
range(as.numeric(!is.na(StormFinal$DAMAGE_PROPERTY)), na.rm = FALSE)  #Range of overall property damage
```
Summary Statistics for property damage amount per year filtered for hurricane events only:
```{R}
StormFilter <- StormFinal %>% filter(EVENT_TYPE == "Hurricane", !is.na(DAMAGE_PROPERTY)) %>%  group_by(EVENT_TYPE, YEAR) %>%
  summarize(DAMAGE_TOTAL=sum(as.numeric(DAMAGE_PROPERTY)))
sd(StormFilter$DAMAGE_TOTAL)
mean(StormFilter$DAMAGE_TOTAL)
range(StormFilter$DAMAGE_TOTAL)
```
Bar graph for property damage amount per year filtered for hurricane events only:
```{R}
StormFilter <- StormFinal %>% filter(EVENT_TYPE == "Hurricane", !is.na(DAMAGE_PROPERTY)) %>%  group_by(EVENT_TYPE, YEAR)

ggplot(data = StormFilter) +
  geom_bar(mapping = aes(x = YEAR))+
  ggtitle("Hurricane Damage per Year") +
  xlab("Hurricane") + ylab("Damage amount")
```
Summary Statistics for hurricane events per year:
```{R}
StormFilter <- StormFinal %>% filter(EVENT_TYPE == "Hurricane") %>%  group_by(YEAR, EVENT_TYPE) %>%
    summarise(CountEvent=(count=n()))

sd(StormFilter$CountEvent)
mean(StormFilter$CountEvent)
range(StormFilter$CountEvent)
```
Scatterplot for hurricane events per year:
```{R}
ggplot(data = StormFilter) + 
  geom_point(mapping=aes(x=YEAR, y=CountEvent, color=EVENT_TYPE))+
  ggtitle("Number of Hurricanes per Year")
```